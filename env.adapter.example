# Database Adapter Configuration
# Copy this to .env to enable database adapter features

# ============================================
# DATABASE ADAPTER SETTINGS
# ============================================

# Enable the new database adapter pattern (default: false)
# Set to 'true' to use IDatabaseAdapter instead of direct SQLite
USE_DATABASE_ADAPTER=true

# Database type selection (sqlite or postgresql)
# Only used when USE_DATABASE_ADAPTER=true
DATABASE_TYPE=sqlite

# Enable adapter logging for debugging (default: false)
ENABLE_ADAPTER_LOGGING=false

# Prefer adapter pattern for new database instances (default: false)
# When true, new code will default to using adapters
PREFER_ADAPTER_FOR_NEW_INSTANCES=false

# Enable dual-mode operation (both patterns active)
# Useful during migration to test both simultaneously
ENABLE_DUAL_MODE=false

# ============================================
# SQLITE CONFIGURATION
# ============================================

# Path to SQLite database file
SQLITE_DATABASE_PATH=./data/crewai_enhanced.db

# SQLite-specific settings
SQLITE_MAX_CONNECTIONS=10
SQLITE_ENABLE_WAL=true
SQLITE_ENABLE_FOREIGN_KEYS=true
SQLITE_CACHE_SIZE=10000
SQLITE_BUSY_TIMEOUT=5000
SQLITE_MEMORY_MAP=268435456
SQLITE_READONLY=false

# ============================================
# POSTGRESQL CONFIGURATION
# ============================================

# PostgreSQL connection settings
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=crewai_team
POSTGRES_USER=crewai_user
POSTGRES_PASSWORD=your_secure_password_here
POSTGRES_SSL=false

# PostgreSQL pool settings
POSTGRES_MAX_CONNECTIONS=20
POSTGRES_MIN_CONNECTIONS=2
POSTGRES_IDLE_TIMEOUT=30000
POSTGRES_CONNECTION_TIMEOUT=5000

# ============================================
# MIGRATION SETTINGS
# ============================================

# Enable compatibility shim for gradual migration
USE_COMPATIBILITY_SHIM=true

# Log migration warnings (helpful during transition)
LOG_MIGRATION_WARNINGS=true

# Fail on adapter errors (set to false during testing)
FAIL_ON_ADAPTER_ERROR=false

# ============================================
# PERFORMANCE SETTINGS
# ============================================

# Query cache settings (applies to both databases)
ENABLE_QUERY_CACHE=true
QUERY_CACHE_SIZE=1000
QUERY_CACHE_TTL=60000

# Connection pool monitoring
MONITOR_CONNECTION_POOLS=true
CONNECTION_POOL_LOG_INTERVAL=60000

# ============================================
# TESTING SETTINGS
# ============================================

# Run tests against both databases
TEST_BOTH_DATABASES=false

# Database for testing (overrides DATABASE_TYPE in tests)
TEST_DATABASE_TYPE=sqlite

# Use in-memory database for tests (SQLite only)
TEST_USE_IN_MEMORY=false

# ============================================
# ROLLBACK SETTINGS
# ============================================

# Emergency rollback to legacy mode
FORCE_LEGACY_MODE=false

# Backup database before adapter operations
AUTO_BACKUP_BEFORE_ADAPTER_OPS=true

# ============================================
# MONITORING & ALERTS
# ============================================

# Send alerts on adapter failures
ALERT_ON_ADAPTER_FAILURE=true

# Alert webhook URL (Discord, Slack, etc.)
ALERT_WEBHOOK_URL=

# Performance threshold for alerts (ms)
PERFORMANCE_ALERT_THRESHOLD=1000

# ============================================
# FEATURE FLAGS
# ============================================

# Enable specific repository migrations
MIGRATE_USER_REPOSITORY=false
MIGRATE_EMAIL_REPOSITORY=false
MIGRATE_WALMART_REPOSITORY=false
MIGRATE_GROCERY_REPOSITORY=false
MIGRATE_DEAL_REPOSITORY=false

# Enable service-level adapter usage
USE_ADAPTER_IN_SERVICES=false
USE_ADAPTER_IN_API_ROUTES=false
USE_ADAPTER_IN_WEBSOCKETS=false
USE_ADAPTER_IN_MICROSERVICES=false

# ============================================
# DEBUGGING
# ============================================

# Verbose logging for adapter operations
ADAPTER_DEBUG_MODE=false

# Log all SQL queries (security risk in production!)
LOG_ALL_QUERIES=false

# Trace adapter method calls
TRACE_ADAPTER_CALLS=false

# ============================================
# NOTES
# ============================================
# 
# Migration Steps:
# 1. Copy this file to .env
# 2. Set USE_DATABASE_ADAPTER=true to enable adapters
# 3. Configure your database settings (SQLite or PostgreSQL)
# 4. Gradually enable feature flags for specific components
# 5. Monitor logs and performance metrics
# 6. Once stable, remove legacy code
#
# Rollback:
# - Set FORCE_LEGACY_MODE=true for immediate rollback
# - Or set USE_DATABASE_ADAPTER=false to disable adapters
#
# Testing:
# - Set TEST_BOTH_DATABASES=true to run tests on both DBs
# - Check logs in ./logs/adapter-migration.log
#